# POJOArrayMapper

A JavaScript library for transforming deeply nested object structures into flat arrays and back again, enabling easy batch processing of nested data.

## Features

- Transform nested object structures into a flat array representation while preserving structural information
- Reconstruct nested objects from processed flat arrays
- Handle complex nested paths with array notation
- Support for empty string keys and special characters in property names
- Robust handling of broken/invalid paths
- No external dependencies (though compatible with lodash if preferred)

## Installation (soon)

```bash
npm install pojo-array-mapper
```

## Usage

### Basic Example

```javascript
import { extractOLeaves, injectOLeaves } from 'pojo-array-mapper';

const data = {
  users: [
    { name: 'John', scores: [85, 92, 78] },
    { name: 'Alice', scores: [95, 88, 91] }
  ]
};

// Extract values to process
const extracted = extractOLeaves({
  obj: data,
  directPathChain: 'users[].scores[]'
});

// Process the flat array of values
const processed = extracted.v.map(score => score + 5);

// Reconstruct the nested structure with processed values
const result = injectOLeaves({
  obj: data,
  processedOLeaves: {
    ...extracted,
    v: processed
  }
});
```

### API Reference

#### extractOLeaves(options)

Extracts values from a nested structure into a flat array format.

```javascript
const options = {
  obj: object,            // The source object to extract from
  directPathChain: string | string[],  // Path to the values to extract
  addBrokenPaths: boolean // Optional: Include invalid paths in result (default: false)
};
```

Returns an object with:
- `d`: Number - Depth of nesting
- `p`: Array - Array of path segments
- `i`: Array - Nested array of indexes/keys preserving structure
- `v`: Array - Flat array of extracted values
- `b`: Boolean - Flag indicating if any paths were broken/invalid

#### injectOLeaves(options)

Reconstructs a nested structure using processed values.

```javascript
const options = {
  obj: object,           // The target object to inject into
  processedOLeaves: {    // Result from extractOLeaves with processed values
    p: string[],         // Original path segments
    i: Array,           // Original structure indexes
    v: Array            // Processed values to inject
  }
};
```

Returns `true` if injection was successful, `false` otherwise.

### Path Syntax

The library supports two ways to specify paths:

1. String format with array notation:
```javascript
'users[].scores[]'    // Extract all scores from all users
'data.items[].value'  // Extract value from each item
```

2. Array format:
```javascript
['users', 'scores']   // Same as 'users[].scores[]'
['data.items', 'value'] // Same as 'data.items[].value'
```

Special features:
- Empty string properties: Use `'""'` in path
- Multiple dots collapse: `'a...b....c'` becomes `'a.b.c'`
- Empty paths (`''`, `[]`, or `['']`) return the object itself

## Error Handling

- Invalid paths return a special `defaultReference` object instead of undefined
- The `addBrokenPaths` option allows including invalid paths in results for debugging
- Failed injections return `false`

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Author

Pablo Benito ([@pelicanorojo](https://github.com/pelicanorojo))

---
*Note: Documentation generated by Claude. The inputs were POJOArrayMapper.js and the prompt: "Write me a Markdown readme for a github project for the attached js. Consider the main functions for users are extractOLeaves and injectOLeaves, and the rest could be used, but are mainly tools for the two above."*
